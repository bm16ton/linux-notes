<!DOCTYPE html>
<html dir="ltr" class="client-js" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<title>GPIO Event Driver - Gumstix User Wiki</title>
<meta name="generator" content="MediaWiki 1.25.3">
<link rel="shortcut icon" href="https://wiki.gumstix.com/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="https://wiki.gumstix.com/opensearch_desc.php" title="Gumstix User Wiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.gumstix.com/api.php?action=rsd">
<link rel="alternate" hreflang="x-default" href="https://wiki.gumstix.com/index.php/GPIO_Event_Driver">
<link rel="alternate" type="application/atom+xml" title="Gumstix User Wiki Atom feed" href="https://wiki.gumstix.com/index.php?title=Special:RecentChanges&amp;feed=atom">
<link rel="stylesheet" href="GPIO%20Event%20Driver%20-%20Gumstix%20User%20Wiki_files/load.css">
<!--[if IE 6]><link rel="stylesheet" href="/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]--><style>
.mw-collapsible-toggle{float:right;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}  .mw-content-ltr .mw-collapsible-toggle,.mw-content-rtl .mw-content-ltr .mw-collapsible-toggle{float:right} .mw-content-rtl .mw-collapsible-toggle,.mw-content-ltr .mw-content-rtl .mw-collapsible-toggle{float:left}.mw-customtoggle,.mw-collapsible-toggle{cursor:pointer} caption .mw-collapsible-toggle,.mw-content-ltr caption .mw-collapsible-toggle,.mw-content-rtl caption .mw-collapsible-toggle,.mw-content-rtl .mw-content-ltr caption .mw-collapsible-toggle,.mw-content-ltr .mw-content-rtl caption .mw-collapsible-toggle{float:none} li .mw-collapsible-toggle,.mw-content-ltr li .mw-collapsible-toggle,.mw-content-rtl li .mw-collapsible-toggle,.mw-content-rtl .mw-content-ltr li .mw-collapsible-toggle,.mw-content-ltr .mw-content-rtl li .mw-collapsible-toggle{float:none} .mw-collapsible-toggle-li{list-style:none}
/* cache key: gumstix_wiki:resourceloader:filter:minify-css:7:e1ffd603cbaaa5f1a36e0d13fe843535 */
.suggestions{overflow:hidden;position:absolute;top:0;left:0;width:0;border:none;z-index:1099;padding:0;margin:-1px 0 0 0}.suggestions-special{position:relative;background-color:white;cursor:pointer;border:solid 1px #aaaaaa;padding:0;margin:0;margin-top:-2px;display:none;padding:0.25em 0.25em;line-height:1.25em}.suggestions-results{background-color:white;cursor:pointer;border:solid 1px #aaaaaa;padding:0;margin:0}.suggestions-result{color:black;margin:0;line-height:1.5em;padding:0.01em 0.25em;text-align:left; overflow:hidden;-o-text-overflow:ellipsis; text-overflow:ellipsis;white-space:nowrap}.suggestions-result-current{background-color:#4C59A6;color:white}.suggestions-special .special-label{color:gray;text-align:left}.suggestions-special .special-query{color:black;font-style:italic;text-align:left}.suggestions-special .special-hover{background-color:silver}.suggestions-result-current .special-label,.suggestions-result-current .special-query{color:white}.highlight{font-weight:bold}
/* cache key: gumstix_wiki:resourceloader:filter:minify-css:7:f8d0c6895ce3ae14434c16b8fca59432 */
.postedit-container{margin:0 auto;position:fixed;top:0;height:0;left:50%;z-index:1000;font-size:13px}.postedit-container:hover{cursor:pointer}.postedit{position:relative;top:0.6em;left:-50%;padding:.6em 3.6em .6em 1.1em;line-height:1.5625em;color:#626465;background-color:#f4f4f4;border:1px solid #dcd9d9;text-shadow:0 0.0625em 0 rgba(255,255,255,0.5);border-radius:5px;box-shadow:0 2px 5px 0 #ccc;-webkit-transition:all 0.25s ease-in-out;-moz-transition:all 0.25s ease-in-out;-ms-transition:all 0.25s ease-in-out;-o-transition:all 0.25s ease-in-out;transition:all 0.25s ease-in-out}.skin-monobook .postedit{top:6em !important}.postedit-faded{opacity:0}.postedit-icon{padding-left:41px;  line-height:25px;background-repeat:no-repeat;background-position:8px 50%}.postedit-icon-checkmark{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABblBMVEUAAAD///////9PfTf///80aRdTgjn///9Feij///////////9Rfzf///////////9PfjZRgDh1o1xOfTb///////+bwYqLtnj///////9PfTa82K////9WhT6YxIL///9QgDdTgzr////////j7uDl7eLq8efi693k7OH///////9UhjuBr2rp9uRUhjr///9YljVKgir///9WiTlYjT3////9/v57vFlbkT5PjC9dlD/5/fhuq09stUTs9uhxuElctCpfnT1huDFloEZloUZmpENmvDZpvDxpvTxqvjxrvT5rvT9rwTxsqktswD5uwkBvuUdxw0NztFBztU9ztVBzwkp0tlJ1xkd2t1R3uVR4w1F4xk54x014yE15uVZ5v1R5xVB6v1R7yFJ8wVh9xVl9yFR9yVd9ylN+xVh+yFd/x1l/yFeAylmEx1+Ny2uY0Hqe04Wj1Ymv3Ze33qLD47TJ5L3O6cPU7Mrq9eb2+/Q4j37OAAAAQHRSTlMAAQIEBAUFBQwPFB4fJCUoKiosQEhJS01RUlZZXmdydXaChYuSlJSWmJmoq6uur8LExcvM19fg5ejt8fX2+Pr7SljgewAAAKpJREFUGBkFwQNCAwAAAMDLtl3LtrG4rWXbtvX77gAgZ6grFwC0bhwNVgKgdPZx8b0dgLi+s7Wn0VoAqpfOI9+BNADZI7fLrz2pSEwGHZuH+78lSK8ZLkLezF3ooyUG3VPXq2USei9WngeyoG195yBYWDF3E/2pAhl1e9Gr8bGT+bfOFCC2fnvh4X7rcqIAQNNu+HT6sxkAjceTL/2ZAIhv+PorBwBJxfkA//dFHSCBy/UTAAAAAElFTkSuQmCC);background-image:url(/resources/src/mediawiki.action/images/green-checkmark.png?2015-10-16T17:01:40Z)!ie;background-position:left}.postedit-close{position:absolute;padding:0 .8em;right:0;top:0;font-size:1.25em;font-weight:bold;line-height:2.3em;color:black;text-shadow:0 0.0625em 0 white;text-decoration:none;opacity:0.2;filter:alpha(opacity=20)}.postedit-close:hover{color:black;text-decoration:none;opacity:0.4;filter:alpha(opacity=40)}
/* cache key: gumstix_wiki:resourceloader:filter:minify-css:7:6b623b1d2c3249c4af996e78916d7381 */</style><style>
.suggestions a.mw-searchSuggest-link,.suggestions a.mw-searchSuggest-link:hover,.suggestions a.mw-searchSuggest-link:active,.suggestions a.mw-searchSuggest-link:focus{color:black;text-decoration:none}.suggestions-result-current a.mw-searchSuggest-link,.suggestions-result-current a.mw-searchSuggest-link:hover,.suggestions-result-current a.mw-searchSuggest-link:active,.suggestions-result-current a.mw-searchSuggest-link:focus{color:white}.suggestions a.mw-searchSuggest-link .special-query{ overflow:hidden;-o-text-overflow:ellipsis; text-overflow:ellipsis;white-space:nowrap}
/* cache key: gumstix_wiki:resourceloader:filter:minify-css:7:ae3fa4570b5ac0c6cf7b3776c8ae4d6f */</style><meta name="ResourceLoaderDynamicStyles" content="">
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: gumstix_wiki:resourceloader:filter:minify-css:7:d8a570e23636135ace41d636d6bd0cfe */</style>
<script src="GPIO%20Event%20Driver%20-%20Gumstix%20User%20Wiki_files/load.php"></script><script src="GPIO%20Event%20Driver%20-%20Gumstix%20User%20Wiki_files/load_002.php"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"GPIO_Event_Driver","wgTitle":"GPIO Event Driver","wgCurRevisionId":4888,"wgRevisionId":4888,"wgArticleId":2152,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["GPIO"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"GPIO_Event_Driver","wgRelevantArticleId":2152,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: gumstix_wiki:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script><script src="GPIO%20Event%20Driver%20-%20Gumstix%20User%20Wiki_files/load_003.php"></script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-GPIO_Event_Driver skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">GPIO Event Driver</h1>

				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Gumstix User Wiki</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" dir="ltr" class="mw-content-ltr" lang="en"><p>This page documents the gpio-event driver, which allows multiple GPIO lines to be monitored from user-space.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2><span class="toctoggle">&nbsp;[<a href="#" id="togglelink">hide</a>]&nbsp;</span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Driver_Sources"><span class="tocnumber">2</span> <span class="toctext">Driver Sources</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Adding_pins_to_be_monitored"><span class="tocnumber">3</span> <span class="toctext">Adding pins to be monitored</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Detecting_events"><span class="tocnumber">4</span> <span class="toctext">Detecting events</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Lauching_a_script"><span class="tocnumber">5</span> <span class="toctext">Lauching a script</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Integrating.2FBuilding_with_Open_Embedded"><span class="tocnumber">6</span> <span class="toctext">Integrating/Building with Open Embedded</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#How_it_works"><span class="tocnumber">7</span> <span class="toctext">How it works</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#gpio_event_init"><span class="tocnumber">7.1</span> <span class="toctext">gpio_event_init</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#gpio_event_open"><span class="tocnumber">7.2</span> <span class="toctext">gpio_event_open</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#GPIO_FileData_t_data_structure"><span class="tocnumber">7.3</span> <span class="toctext">GPIO_FileData_t data structure</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#gpio_event_ioctl"><span class="tocnumber">7.4</span> <span class="toctext">gpio_event_ioctl</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#gpio_event_poll"><span class="tocnumber">7.5</span> <span class="toctext">gpio_event_poll</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#gpio_event_read"><span class="tocnumber">7.6</span> <span class="toctext">gpio_event_read</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#gpio_event_release"><span class="tocnumber">7.7</span> <span class="toctext">gpio_event_release</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#gpio_event_monitor"><span class="tocnumber">7.8</span> <span class="toctext">gpio_event_monitor</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#GPIO_PinData_t_data_structure"><span class="tocnumber">7.9</span> <span class="toctext">GPIO_PinData_t data structure</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#gpio_event_irq"><span class="tocnumber">7.10</span> <span class="toctext">gpio_event_irq</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#gpio_event_timer"><span class="tocnumber">7.11</span> <span class="toctext">gpio_event_timer</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#gpio_event_dequeue_event"><span class="tocnumber">7.12</span> <span class="toctext">gpio_event_dequeue_event</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#gpio_event_queue_event"><span class="tocnumber">7.13</span> <span class="toctext">gpio_event_queue_event</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#find_pin"><span class="tocnumber">7.14</span> <span class="toctext">find_pin</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#pins_proc_open"><span class="tocnumber">7.15</span> <span class="toctext">pins_proc_open</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#pin_seq_xxx"><span class="tocnumber">7.16</span> <span class="toctext">pin_seq_xxx</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<p>The gpio-event driver consists of a loadable kernel module, which 
registers an interrupt handler, along with an example user-mode program,
 which allows the settings to be manipulated and changes to be reported.
</p>
<h2><span class="mw-headline" id="Driver_Sources">Driver Sources</span></h2>
<p>The source code can be found <a rel="nofollow" class="external text" href="http://svn.hylands.org/linux/gpio-event/">here</a>.
 The app directory contains the example user mode application, and the 
module directory contains the loadable kernel module. The Makefiles have
 been setup such that if you define the environment variable OVEROTOP 
then you should be able to just type make in top level directory and 
both the app and module will be built.
</p><p>There are also some bitbake recipes in the <a rel="nofollow" class="external text" href="http://svn.hylands.org/linux/oe/user.collection/recipes/gpio-event-app">gpio-event-app</a> and <a rel="nofollow" class="external text" href="http://svn.hylands.org/linux/oe/user.collection/recipes/gpio-event-module">gpio-event-module</a> directories.
</p>
<h2><span class="mw-headline" id="Adding_pins_to_be_monitored">Adding pins to be monitored</span></h2>
<p>The gpio-event program can be used to add gpio pins to be monitored. 
Simply run the gpio-event program, passing it a pin specification of the
 form: pin:edge:debounce. pin should be the GPIO number that you want to
 monitor. Edge should be r, f, or b to monitor rising, falling, or both 
edges, and debounce should be the number of milliseconds of debounce 
that you'd like. A debounce of 0 may be used for "clean" signals. For 
example:
</p>
<pre>gpio-event 58:f:20 59:r:20 60:b:20
</pre>
<p>would cause gpio 58 to be monitored for falling edges, gpio 59 to be 
monitored for rising edges, and gpio 60 to be monitored for both rising 
and falling edges. Each pin will have a debounce of 20 milliseconds 
(which should be adequate for most pushbuttons).
</p><p>You can pass as many pins to be monitored as you'd like on the 
command line. Each call is cumulative. If you specify the same pin, the 
new specification will override whatever is currently set. You can see 
the current pins being monitored by using:
</p>
<pre>cat /proc/gpio-event/pins
</pre>
<p>Passing in a negative gpio number will cause the pin to stop being monitored.
</p>
<h2><span class="mw-headline" id="Detecting_events">Detecting events</span></h2>
<p>Once pins are setup to be monitored, any program can read 
/dev/gpio-event to get notified of the events. By default, an ASCII 
string of the form: "pin edge timestamp" followed by a newline will be 
delievered to /dev/gpio-event for each event that occurs. Running 
gpio-event with the -m or --monitor command line will cause the events 
to be monitored and printed. You could also use the command:
</p>
<pre>cat /dev/gpio-event
</pre>
<p>to achieve a similar result. For C programs, you can opt to use a 
binary interface instead. The binary versus ASCII setting is maintained 
on a per-file basis, so each program could each open /dev/gpio-event 
with a different ASCII/binary setting.
</p><p>The edge will be an R or an F depending on whether a rising or 
falling edge is being reported. The timestamp is a number with the 
integer portion being the current system time (as returned from the 
gettimeofday function) and the fractional portion reporting in 
microseconds.
</p>
<h2><span class="mw-headline" id="Lauching_a_script">Lauching a script</span></h2>
<p>The gpio-event program can also be given the -e or --execute command 
line option, and the provided program or script will be launched with 
the same 3 paramters (gpio edge timestamp). For example:
</p>
<pre>gpio-event --execute echo
</pre>
<p>will produce similar output to
</p>
<pre>gpio-event --monitor
</pre>
<h2><span class="mw-headline" id="Integrating.2FBuilding_with_Open_Embedded">Integrating/Building with Open Embedded</span></h2>
<p>In order to build the driver under OE, you can do the following:
</p>
<pre> cd to the directory containing org.embedded.dev
 svn co http://svn.hylands.org/linux/oe/user.collection user.collection
 bitbake task-gpio-all
</pre>
<p>This will build the following packages for gpio-event:
</p>
<pre>./deploy/glibc/ipk/overo/gpio-event-module_svn20100218-r50.5_overo.ipk
./deploy/glibc/ipk/armv7a/gpio-event-app_svn20100218-r2.5_armv7a.ipk
</pre>
<p>and these packages for the <a href="https://wiki.gumstix.com/index.php/User_GPIO_Driver" title="User GPIO Driver">User GPIO Driver</a>
</p>
<pre>./deploy/glibc/ipk/overo/gpio-module_svn20100218-r50.5_overo.ipk
./deploy/glibc/ipk/armv7a/gpio-app_svn20100218-r0.5_armv7a.ipk
./deploy/glibc/ipk/armv7a/gpio-lib_svn20100218-r0.5_armv7a.ipk
</pre>
<p>Note that the numeric portions of the pathnames will almost certainly be different.
</p>
<h2><span class="mw-headline" id="How_it_works">How it works</span></h2>
<p>Everything starts with the module_init directive near the very end of
 the gpio-event-drv.c file. The function passed to this directive, 
namely gpio_event_init, will be called automatically when the module is 
loaded. Similarly, the gpio_event_exit function, passed to the 
module_exit directive, will be called when the module is unloaded.
</p>
<h3><span class="mw-headline" id="gpio_event_init">gpio_event_init</span></h3>
<ul><li> alloc_chrdev_region - Allocates a major number dynamically</li>
<li> create_proc_entry - Creates a directory, namely /proc/gpio-event</li>
<li> create_proc_entry - Creates a proc entry, namely 
/proc/gpio-event/pins. This particular proc entry is processed using the
 functions described in pins_proc_ops.</li>
<li> register_sysctl_table - Registers some sysctl entries, described by
 gSysCtl and gSysCtlSample. I find using sysctl entries a quick and easy
 way to enable debug flags in my drivers. The sysctl entries will appear
 in /proc/sys/gpio-event and cause the global variables gLostEvents, 
gDebugTrace, gDebugIoctl, and gDebugError to be manipulated.</li>
<li> cdev_init associates the functions in gpio_event_fops against the major number allocated earlier with alloc_chrdev_region.</li>
<li> cdev_add registers the driver with the kernel, and makes it "go 
live". Once cdev_add is called, user mode programs can open the driver.</li>
<li> class_create creates a class, and device_create registers that 
class. This gets picked up by udev which will create the /dev/gpio-entry
 and associate with the dynamically allocated major number.</li></ul>
<h3><span class="mw-headline" id="gpio_event_open">gpio_event_open</span></h3>
<p>gpio_event_open is called when a user mode program calls open on 
/dev/gpio-event. The gpio-event driver assumes that it can be opened by 
multiple applications simultaneously, and uses a GPIO_FileData_t 
structure to keep track of each instance of the driver which is open. 
gFileList is a kernel list which contains a list of all of the currently
 open GPIO_FileData_t data structures.
</p>
<h3><span class="mw-headline" id="GPIO_FileData_t_data_structure">GPIO_FileData_t data structure</span></h3>
<table cellspacing="0" cellpadding="4" border="1 px">

<tbody><tr>
<th> list
</th>
<td> Element used to make list of GPIO_FileData_t structures
</td></tr>
<tr>
<th> waitQueue
</th>
<td> Object that reader waits on when no events are available.
</td></tr>
<tr>
<th> queueLock
</th>
<td> Mutual exclusion lock acquired when manipulating queueData, getIndex, putIndex, or numEvents.
</td></tr>
<tr>
<th> queueData
</th>
<td> Circular queue of events waiting to be read for a given file.
</td></tr>
<tr>
<th> getIndex
</th>
<td> Index of the next item to be retrieved from the circular queue.
</td></tr>
<tr>
<th> putIndex
</th>
<td> Index of the next place that an event will be placed into the circular queue.
</td></tr>
<tr>
<th> numEvents
</th>
<td> The number of events currently in the circular queue.
</td></tr>
<tr>
<th> readMode
</th>
<td> Determines if this file is being read in binary or ASCII mode. Defaults to ASCII.
</td></tr>
<tr>
<th> buffer
</th>
<td> Contains the next event worth of data, formatted in either binary or ASCII format.
</td></tr>
<tr>
<th> bufBytes
</th>
<td> The number of bytes of data that are currently sitting in buffer.
</td></tr></tbody></table>
<p>Note: When manipuating the gFileList linked list, the driver should hold the gFileListLock spinlock with interrupts disabled.
</p>
<h3><span class="mw-headline" id="gpio_event_ioctl">gpio_event_ioctl</span></h3>
<p>gpio_event_ioctl is called when a user mode program issues an ioctl 
call on the file handle returned from opening /dev/gpio-event. The user 
mode program can use GPIO_EVENT_IOCTL_MONITOR_GPIO to add/removee/modify
 monitoring for a pin. The user mode program can use 
GPIO_EVENT_IOCTL_SET_READ_MODE to set the read mode to binary or ASCII.
</p>
<h3><span class="mw-headline" id="gpio_event_poll">gpio_event_poll</span></h3>
<p>gpio_event_poll adds the appropriate glue to allow the poll or select
 calls to work as expected from user mode. Basically, this function 
determines if there is data to be read or not.
</p>
<h3><span class="mw-headline" id="gpio_event_read">gpio_event_read</span></h3>
<p>gpio_event_read is called when the user issues a read call on the 
files handle returned from opening /dev/gpio-event. It first checks to 
see if any data remains from previous calls. If a non-blocking read is 
performed and no events are available, then it returns immediately, 
otherwise it blocks waiting for an event to be placed in the queue 
before returning. If multiple events are available, and the caller 
provided sufficient buffer space, then as much data as can be returned 
will be. gpio_event_dequeue_event is called to retrieve queued events.
</p>
<h3><span class="mw-headline" id="gpio_event_release">gpio_event_release</span></h3>
<p>gpio_event_release is called when a given file handle is closed. It 
removes the GPIO_FileData_t structure from the list of open files.
</p>
<h3><span class="mw-headline" id="gpio_event_monitor">gpio_event_monitor</span></h3>
<p>gpio_event_monitor is called in response to the 
GPIO_EVENT_IOCTL_MONITOR_GPIO ioctl. If monitoring for a pin is being 
added, then request_irq is called to register an interrupt handler, 
gpio_event_irq, whenever an appropriate type of edge is detected, and 
init_timer is called to setup the debounce timer. If monitoring for a 
pin is being removed, then free_irq is called, along with del_timer_sync
 to unregister the timer.
</p>
<h3><span class="mw-headline" id="GPIO_PinData_t_data_structure">GPIO_PinData_t data structure</span></h3>
<p>There is an instance of this structure for each pin which is actively being monitored.
</p>
<table cellspacing="0" cellpadding="4" border="1 px">

<tbody><tr>
<th> list
</th>
<td> Element used to make list of GPIO_PinData_t structures
</td></tr>
<tr>
<th> gpio
</th>
<td> The gpio pin which is being monitored.
</td></tr>
<tr>
<th> debounceTimer
</th>
<td> Timer object used to perform debounce.
</td></tr>
<tr>
<th> debounceMilliSec
</th>
<td> Amount of time that the debounce timer should be activated for after an edge.
</td></tr>
<tr>
<th> devName
</th>
<td> device name used when registering an irq handler (shows up in /proc/irq)
</td></tr>
<tr>
<th> edgeType
</th>
<td> The type of edge that is being monitored.
</td></tr>
<tr>
<th> pinState
</th>
<td> Holds the current state of the pin.
</td></tr></tbody></table>
<p>Note: When manipuating the gPinList linked list, the driver should hold the gPinListLock spinlock with interrupts disabled.
</p>
<h3><span class="mw-headline" id="gpio_event_irq">gpio_event_irq</span></h3>
<p>gpio_event_irq is called whenever an edge is detected on enabled 
pins. The type of edge is determined and an event is queued using 
gpio_event_queue_event. If pin deboucing is used, then interrupts are 
disabled (for the particular pin) and a timer is started. 
</p>
<h3><span class="mw-headline" id="gpio_event_timer">gpio_event_timer</span></h3>
<p>If debouncing is used on a pin, then a timer is started when an edge 
occurs. This allows interrupts to be disabled for a short time when the 
pin "bounces" or generates lots of edges. At the end of the timeout, 
interrupts are re-enabled.
</p>
<h3><span class="mw-headline" id="gpio_event_dequeue_event">gpio_event_dequeue_event</span></h3>
<p>gpio_event_dequeue_event is called to retrieve any events queued up for a given file descriptor.
</p>
<h3><span class="mw-headline" id="gpio_event_queue_event">gpio_event_queue_event</span></h3>
<p>gpio_event_queue_event adds an event to all open file descriptors. 
The waitQueues for each file descriptor is also "woken" which allows any
 readers which are blocked waiting for an event to run.
</p>
<h3><span class="mw-headline" id="find_pin">find_pin</span></h3>
<p>find_pin is a utility function to detemine if a particular gpio is being monitored.
</p>
<h3><span class="mw-headline" id="pins_proc_open">pins_proc_open</span></h3>
<p>Called when a user mode program opens /proc/gpio-event/pins
</p>
<h3><span class="mw-headline" id="pin_seq_xxx">pin_seq_xxx</span></h3>
<p>Set of functions which are called to process the output which goes to /proc/gpio-event/pins.
</p>
<!-- 
NewPP limit report
CPU time usage: 0.018 seconds
Real time usage: 0.033 seconds
Preprocessor visited node count: 100/1000000
Preprocessor generated node count: 116/1000000
Postâ€expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key gumstix_wiki:pcache:idhash:2152-0!*!0!!en!*!* and timestamp 20201207210353 and revision id 4888
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.gumstix.com/index.php?title=GPIO_Event_Driver&amp;oldid=4888">https://wiki.gumstix.com/index.php?title=GPIO_Event_Driver&amp;oldid=4888</a>"</div>
					<div id="catlinks" class="catlinks"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="https://wiki.gumstix.com/index.php/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="https://wiki.gumstix.com/index.php/Category:GPIO" title="Category:GPIO">GPIO</a></li></ul></div></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="https://wiki.gumstix.com/index.php/GPIO_Event_Driver" title="View the content page [Alt+Shift+c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="https://wiki.gumstix.com/index.php?title=Talk:GPIO_Event_Driver&amp;action=edit&amp;redlink=1" title="Discussion about the content page [Alt+Shift+t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="https://wiki.gumstix.com/index.php?title=GPIO_Event_Driver&amp;action=edit" title="This page is protected.
You can view its source [Alt+Shift+e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="https://wiki.gumstix.com/index.php?title=GPIO_Event_Driver&amp;action=history" title="Past revisions of this page [Alt+Shift+h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-login"><a href="https://wiki.gumstix.com/index.php?title=Special:UserLogin&amp;returnto=GPIO+Event+Driver" title="You are encouraged to log in; however, it is not mandatory [Alt+Shift+o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="https://wiki.gumstix.com/index.php/Main_Page" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class="pBody">
							<ul>
											<li id="n-mainpage-description"><a href="https://wiki.gumstix.com/index.php/Main_Page" title="Visit the main page [Alt+Shift+z]" accesskey="z">Main page</a></li>
											<li id="n-recentchanges"><a href="https://wiki.gumstix.com/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [Alt+Shift+r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="https://wiki.gumstix.com/index.php/Special:Random" title="Load a random page [Alt+Shift+x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="/index.php" id="searchform">
					<input type="hidden" name="title" value="Special:Search">
					<input type="search" name="search" placeholder="Search" title="Search Gumstix User Wiki [Alt+Shift+f]" accesskey="f" id="searchInput" autocomplete="off">
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton">&nbsp;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton">
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="https://wiki.gumstix.com/index.php/Special:WhatLinksHere/GPIO_Event_Driver" title="A list of all wiki pages that link here [Alt+Shift+j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="https://wiki.gumstix.com/index.php/Special:RecentChangesLinked/GPIO_Event_Driver" title="Recent changes in pages linked from this page [Alt+Shift+k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="https://wiki.gumstix.com/index.php/Special:SpecialPages" title="A list of all special pages [Alt+Shift+q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="https://wiki.gumstix.com/index.php?title=GPIO_Event_Driver&amp;printable=yes" rel="alternate" title="Printable version of this page [Alt+Shift+p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="https://wiki.gumstix.com/index.php?title=GPIO_Event_Driver&amp;oldid=4888" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="https://wiki.gumstix.com/index.php?title=GPIO_Event_Driver&amp;action=info" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-poweredbyico">
									<a href="https://www.mediawiki.org/"><img src="GPIO%20Event%20Driver%20-%20Gumstix%20User%20Wiki_files/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="GPIO%20Event%20Driver%20-%20Gumstix%20User%20Wiki_files/poweredby_mediawiki_132x47.png 1.5x, GPIO%20Event%20Driver%20-%20Gumstix%20User%20Wiki_files/poweredby_mediawiki_176x62.png 2x" width="88" height="31"></a>
							</div>
					<ul id="f-list">
									<li id="lastmod"> This page was last modified on 23 November 2010, at 15:46.</li>
									<li id="privacy"><a href="https://wiki.gumstix.com/index.php/Gumstix_User_Wiki:Privacy_policy" title="Gumstix User Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="https://wiki.gumstix.com/index.php/Gumstix_User_Wiki:About" title="Gumstix User Wiki:About">About Gumstix User Wiki</a></li>
									<li id="disclaimer"><a href="https://wiki.gumstix.com/index.php/Gumstix_User_Wiki:General_disclaimer" title="Gumstix User Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"ready","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":314});
}</script>
<div style="display: none; font-size: 11.4617px;" class="suggestions"><div class="suggestions-results"></div><div class="suggestions-special"></div></div></body></html>