define(["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(e,t,a,i){t=t.init("formAjax"),e.widget("cnet.formAjax",e.fly.base,{options:{messageThankYou:"Thank you!",errorMessages:{"cnet.notsent":"There was an error attempting to send your e-mail.  Please try again.","cnet.nousername":"You must have a valid username to use this form.","cnet.notloggedin":"You must be logged in to use this form.","cnet.newsletter.optin":"Please check your email to confirm your subscription.","cnet.newsletter.invalid_email":"Please enter a valid e-mail address.","cnet.newsletter.error":"There was a problem submitting your request. Please try again later.","cnet_recaptcha.missing-input-secret":"The secret parameter is missing.","cnet_recaptcha.invalid-input-secret":"The secret parameter is invalid or malformed.","cnet_recaptcha.missing-input-response":"Please verify to help prevent automated abuse of this feature.","cnet_recaptcha.invalid-input-response":"The response parameter is invalid or malformed."},tracking:null,selector:{submitButton:'button[data-submit="subscribe"]'}},_create:function(){this._super(),this._setupEvents()},_setupEvents:function(){var t=this,a=this.$element,i=e(".newsletter-subscribe-form p.description"),r=e('[data-component="recaptcha"]',a),s=e('[data-email-var="error"]',a),n=e("input[type=checkbox][data-required]",a),o=e(t.options.selector.submitButton,a);n&&n.on("click",function(){this.checked?o.removeAttr("disabled"):o.attr("disabled",!0)}),a.formValidate({success:function(n){n.preventDefault(),e.ajax({dataType:"json",url:a.attr("action"),data:a.serialize(),type:"POST"}).done(function(e){var n="string"==typeof e?JSON.parse(e):e;"success"===n.status?(i.hide(),a.html(t.options.messageThankYou),t.options.tracking&&t._trackSubmit()):(n.errors?s.text(n.errors[0]):s.text(t.options.errorMessages[n.message]),r.length&&r.recaptcha("reload"))})}})},_trackSubmit:function(){var e=i.tracking.data;a.trackCustomEvent("trackPageEvent",{articleId:e.articleId,articleTitle:e.articleTitle,articleType:e.articleType,clickGenericText:this.options.tracking,collectionId:e.collectionId,pageTitle:e.photoGalleryTitle,pageType:e.pageType,pageViewGuid:e.pageViewGuid,siteEdition:e.siteEdition,siteHier:e.siteHier,siteSection:e.siteSection,topicId:e.topicId,_dwAnonId:e._dwAnonId,brand:e.brand},"trackClick")}})});