(self.AMP=self.AMP||[]).push({m:0,v:"2110011758000",n:"amp-auto-lightbox",ev:"0.1",l:true,f:function(AMP,_){"use strict";function p(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object")})()}p(this);"function"===typeof Symbol&&Symbol("x");function q(a){return a?Array.prototype.slice.call(a):[]}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function r(a,b){for(;a&&void 0!==a;a=a.parentElement)if(b(a))return a;return null}function t(a,b){return a.closest?a.closest(b):r(a,(function(c){var d=c.matches||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector||c.oMatchesSelector;return d?d.call(c,b):!1}))}function u(a,b){for(a=a.lastElementChild;a;a=a.previousElementSibling)if(b(a))return a;return null}var v={bubbles:!0,cancelable:!0};var w;function x(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}function y(a){a.tagName.startsWith("AMP-");if(a.createdCallback)return Promise.resolve(a);if(!a.__AMP_UPG_PRM){var b=new x;a.__AMP_UPG_PRM=b.promise;a.__AMP_UPG_RES=b.resolve}return a.__AMP_UPG_PRM}function z(a,b){var c={needsRootBounds:!1},d=c=void 0===c?{}:c,e=d.needsRootBounds;return new b.IntersectionObserver(a,{threshold:d.threshold,root:b.parent&&b.parent!=b&&e?b.document:void 0})}new WeakMap;new WeakMap;var A,B;function C(a){A||(A=new WeakMap,B=new WeakMap);var b=B.get(a);b||(b=z((function(c){for(var d=new Set,e=c.length-1;0<=e;e--){var f=c[e].target;d.has(f)||(d.add(f),b.unobserve(f),A.get(f).resolve(c[e]),A.delete(f))}}),a),B.set(a,b));return b}function D(a){var b;if(null==(b=A)?0:b.has(a))return A.get(a).promise;C(a.ownerDocument.defaultView).observe(a);b=new x;A.set(a,b);return b.promise}var E=self.AMP_CONFIG||{},F=("string"==typeof E.cdnProxyRegex?new RegExp(E.cdnProxyRegex):E.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function G(a){if(self.document&&self.document.head&&(!self.location||!F.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}E.cdnUrl||G("runtime-host");E.geoApiUrl||G("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var H=self.__AMP_LOG;function I(){throw Error("failed to call initLogConstructor")}function J(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return K(a,b)}function M(a,b){var c=N(a);c=O(c);return K(c,b)}function N(a){return a.nodeType?J((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function O(a){a=N(a);return a.isSingleDoc()?a.win:a}function K(a,b){P(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function P(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor)}var Q;function R(a,b,c,d){function e(m){try{return g(m)}catch(L){var h,n;null==(n=(h=self).__AMP_REPORT_ERROR)||n.call(h,L);throw L}}var f=a,g=c,l=S(),k=!(null==d||!d.capture);f.addEventListener(b,e,l?d:k);return function(){var m;null==(m=f)||m.removeEventListener(b,e,l?d:k);e=f=g=null}}function S(){if(void 0!==Q)return Q;Q=!1;try{var a={get capture(){Q=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return Q}function T(a,b,c,d){var e=c,f=R(a,b,(function(g){try{e(g)}finally{e=null,f()}}),d);return f}function U(a){return!!(a.complete||"complete"==a.readyState||V(a)&&0<a.readyState||a.document&&"complete"==a.document.readyState)}function W(a){var b,c;if(U(a))return Promise.resolve(a);var d=V(a);return d&&a.__AMP_MEDIA_LOAD_FAILURE_SRC===a.currentSrc?Promise.reject(a):new Promise((function(e,f){b=d?T(a,"loadedmetadata",e,{capture:!0}):T(a,"load",e);if(a.tagName){var g=a;if(d&&!a.hasAttribute("src")&&(g=u(a,(function(l){return"SOURCE"===l.tagName})),!g))return f(Error("Media has no source."));c=T(g,"error",f)}})).then((function(){c&&c();return a}),(function(){b&&b();V(a)&&(a.__AMP_MEDIA_LOAD_FAILURE_SRC=a.currentSrc||!0);var e=a;e&&e.src&&(e=e.src);H.user||(H.user=I());throw H.user.createError("Failed to load:",e)}))}function V(a){return"AUDIO"===a.tagName||"VIDEO"===a.tagName}/nochunking=1/.test(self.location.hash);(function(){return w?w:w=Promise.resolve(void 0)})();var X={Article:!0,NewsArticle:!0,BlogPosting:!0,LiveBlogPosting:!0,DiscussionForumPosting:!0};function aa(){}var ba=/\s+([0-9]+)w(,|[\S\s]*$)/g;function ca(a){return M(a,"mutator").mutateElement(a,(function(){a.setAttribute("i-amphtml-auto-lightbox-visited","")}))}function da(){return["amp-img","img"].map((function(a){return a+":not([lightbox]):not([i-amphtml-auto-lightbox-visited])"})).join(",")}function ea(a){return"IMG"===a.tagName?W(a):y(a).then((function(b){return b.signals().whenSignal("load-end")}))}function fa(a){return q(a.getRootNode().querySelectorAll('script[type="application/ld+json"]')).map((function(b){try{var c=JSON.parse(b.textContent)}catch(d){c=null}return(c||{})["@type"]})).filter(Boolean)}function ha(a){return fa(a).some((function(b){return X[b]}))}function ia(a){function b(c){return!!a.getRootNode().querySelector(c)}return b('script[custom-element="amp-lightbox-gallery"]')&&b("[lightbox]:not([i-amphtml-auto-lightbox-visited])")}var ja=0;function ka(a,b){return M(a,"mutator").mutateElement(b,(function(){b.setAttribute("lightbox","i-amphtml-auto-lightbox-"+ja++)})).then((function(){J(a.win,"extensions").installExtensionForDoc(a,"amp-lightbox-gallery");var c=b.ownerDocument.createEvent("Event");c.data={};c.initEvent("amp-auto-lightbox:newly-set",v.bubbles,v.cancelable);b.dispatchEvent(c);return b}))}function la(a,b){b.map((function(c){return ea(c).then((function(){return D(c).then((function(d){var e=d.boundingClientRect;if(d="IMG"===c.tagName||c.signals().get("load-end")){d=e.width;var f=e.height,g=c.querySelector("img")||c,l=g.naturalHeight;var k=g.naturalWidth;var m=k/l;var h=-1;if(g=g.getAttribute("srcset"))for(var n;n=ba.exec(g);)n=parseInt(n[1],10),n>h&&(h=n);k=h>k?{naturalWidth:h,naturalHeight:h/m}:{naturalWidth:k,naturalHeight:l};l=k.naturalHeight;k=k.naturalWidth;h=M(a,"viewport").getSize();m=h.width;h=h.height;d*=f;if(d=1.2<=k*l/d||k>m||l>h||.25<=d/(m*h))"IMG"===c.tagName&&t(c,"amp-img")||t(c,"a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]")?d=!1:(d=N(a||c),d=O(d),d=!(P(d,"action")?K(d,"action"):null).hasResolvableAction(c,"tap"))}if(d)return(H.dev||(H.dev=I())).info("amp-auto-lightbox","apply",c),ka(a,c)}))}),aa)}))}function Y(a){var b=Z;if(ia(b))var c=0;else c=(c=b.getRootNode().querySelector('meta[property="og:type"]'))?c.getAttribute("content"):void 0,c="article"==c||ha(b);if(c){c=a||b.win.document;var d=da();c=q(c.querySelectorAll(d));c.forEach(ca);la(b,c)}else(H.dev||(H.dev=I())).info("amp-auto-lightbox","disabled")}var Z=AMP.ampdoc;Z.whenReady().then((function(){Z.getRootNode().addEventListener("amp:dom-update",(function(a){Y(a.target)}));Y()}))}});//# sourceMappingURL=amp-auto-lightbox-0.1.js.map